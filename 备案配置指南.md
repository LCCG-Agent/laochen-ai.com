# 网站备案配置指南

> **重要提示**: 本指南专门针对中国大陆ICP备案要求进行配置

---

## 🎯 备案端口要求

### 必须使用标准端口

中国大陆网站备案**必须**使用以下标准端口：

| 端口 | 协议 | 用途 | 备案要求 |
|------|------|------|----------|
| **80** | HTTP | 网站访问 | ✅ **必须开放** |
| **443** | HTTPS | 安全访问 | ✅ **强烈建议** |
| 8000 | 自定义 | 后端API | ⚠️ 可选（内部使用）|

### ❌ 不能使用非标准端口

备案网站**不能**使用以下端口访问：
- ❌ 3000（开发端口）
- ❌ 8080（非标准HTTP）
- ❌ 其他自定义端口

---

## 📋 当前配置

项目已经配置为使用标准端口：

### Docker 端口映射

```yaml
# docker-compose.yml
services:
  frontend:
    ports:
      - "80:3000"  # 将容器内部3000映射到主机80端口
    environment:
      NEXT_PUBLIC_API_URL: http://101.34.79.228:8000
```

### 访问地址

- ✅ **前端**：http://101.34.79.228 (80端口，无需输入端口号)
- ✅ **后端API**：http://101.34.79.228:8000
- ✅ **API文档**：http://101.34.79.228:8000/docs

---

## 🔥 防火墙配置

### 腾讯云控制台防火墙（必须配置）

1. **登录控制台**：https://console.cloud.tencent.com/lighthouse

2. **进入防火墙设置**：
   - 选择你的服务器实例
   - 点击"防火墙"选项卡

3. **添加规则**：

| 类型 | 协议 | 端口 | 来源 | 说明 |
|------|------|------|------|------|
| 自定义 | TCP | 80 | 0.0.0.0/0 | HTTP（必须）|
| 自定义 | TCP | 443 | 0.0.0.0/0 | HTTPS（建议）|
| 自定义 | TCP | 8000 | 0.0.0.0/0 | 后端API |
| SSH | TCP | 22 | 0.0.0.0/0 | 保留 |

4. **保存规则**

### 服务器系统防火墙（可选）

如果服务器启用了 UFW：

```bash
# 查看防火墙状态
sudo ufw status

# 开放端口
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 8000/tcp

# 重新加载
sudo ufw reload
```

---

## 🔒 HTTPS 配置（强烈建议）

备案网站强烈建议配置 HTTPS（443端口）。

### 方案1：使用 Nginx 反向代理 + Let's Encrypt

#### 1. 安装 Nginx

```bash
sudo apt update
sudo apt install nginx -y
```

#### 2. 配置 Nginx

创建配置文件：

```bash
sudo nano /etc/nginx/sites-available/laochen-ai
```

添加以下内容：

```nginx
# HTTP 配置（80端口）
server {
    listen 80;
    server_name 101.34.79.228;  # 备案后改为域名

    # 重定向到 HTTPS（可选，备案后启用）
    # return 301 https://$server_name$request_uri;

    # 前端代理
    location / {
        proxy_pass http://localhost:80;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # 后端API代理
    location /api {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

# HTTPS 配置（443端口，备案后配置）
# server {
#     listen 443 ssl http2;
#     server_name yourdomain.com;
#
#     ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
#
#     location / {
#         proxy_pass http://localhost:80;
#         # ... 其他配置同上
#     }
# }
```

#### 3. 启用配置

```bash
# 创建软链接
sudo ln -s /etc/nginx/sites-available/laochen-ai /etc/nginx/sites-enabled/

# 测试配置
sudo nginx -t

# 重启 Nginx
sudo systemctl restart nginx
```

#### 4. 申请 SSL 证书（备案后）

```bash
# 安装 Certbot
sudo apt install certbot python3-certbot-nginx -y

# 申请证书（替换为你的域名）
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# 证书会自动续期
sudo certbot renew --dry-run
```

---

## 📝 备案注意事项

### 必须做到的事项

1. ✅ **使用80端口**
   - 网站必须通过 http://你的IP 或 http://你的域名 访问
   - 不能使用 :3000 这样的端口后缀

2. ✅ **内容合规**
   - 网站内容必须符合法律法规
   - 不能有违规内容
   - 纯信息展示类网站（如你的AI工具平台）通常没问题

3. ✅ **显示备案号**
   - 在网站底部显著位置显示ICP备案号
   - 格式：`ICP备XXXXXXXX号`
   - 备案号需链接到：http://beian.miit.gov.cn/

4. ✅ **备案期间网站可访问**
   - 备案审核期间（7-20天），网站必须能正常访问
   - 不能显示"建设中"等页面

5. ✅ **服务器在中国大陆**
   - 你使用的是腾讯云服务器，已满足此要求

### 建议做到的事项

1. 🔒 **配置HTTPS**
   - 提升安全性
   - 提升搜索引擎排名
   - 现代浏览器友好

2. 📱 **响应式设计**
   - 支持手机访问
   - 提升用户体验

3. 📄 **添加必要页面**
   - 关于我们
   - 联系方式
   - 隐私政策
   - 用户协议

---

## 🚀 部署流程（使用80端口）

### 1. 本地推送代码

```bash
# 已修改为使用80端口
git add .
git commit -m "feat: 配置80端口用于备案"
git push origin main
```

### 2. 服务器部署

```bash
ssh ubuntu@101.34.79.228
./deploy-server.sh
```

### 3. 验证访问

```bash
# 直接访问IP（无需端口号）
http://101.34.79.228
```

---

## 🔍 验证清单

部署完成后，请检查：

- [ ] 访问 http://101.34.79.228 能正常打开网站
- [ ] 不需要输入 :3000 或其他端口号
- [ ] 防火墙已开放80端口
- [ ] （可选）防火墙已开放443端口
- [ ] 网站内容符合备案要求
- [ ] 准备在底部添加备案号的位置

---

## 📞 常见问题

### Q1: 为什么必须使用80端口？

**A**: 中国工信部规定，备案网站必须使用标准HTTP端口（80）和HTTPS端口（443），不允许使用非标准端口（如3000、8080等）。这是为了规范互联网管理。

### Q2: 后端API可以用8000端口吗？

**A**: 可以。后端API端口（8000）是内部调用，不影响备案。但前端页面访问必须是80端口。

### Q3: 需要配置域名吗？

**A**: 备案时通常需要域名。备案流程：
1. 先购买域名
2. 提交备案申请
3. 审核通过后（7-20天）
4. 将域名解析到服务器IP
5. 配置Nginx和SSL证书

### Q4: 可以先用IP访问备案吗？

**A**: 大部分情况下需要域名备案。建议：
1. 先购买域名（阿里云、腾讯云等）
2. 同时申请备案
3. 备案期间使用IP访问测试

### Q5: 如何在网站底部添加备案号？

**A**: 备案通过后，会获得备案号（如：`京ICP备12345678号`）。在网站Footer组件添加：

```jsx
<footer>
  <a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">
    ICP备XXXXXXXX号
  </a>
</footer>
```

---

## 📚 相关文档

- 工信部备案管理系统：http://beian.miit.gov.cn/
- 腾讯云备案指南：https://cloud.tencent.com/document/product/243
- Let's Encrypt 证书申请：https://letsencrypt.org/

---

**最后更新**: 2026-02-01  
**配置状态**: ✅ 已配置80端口，满足备案要求
